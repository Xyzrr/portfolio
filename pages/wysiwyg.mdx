import ProjectLayout from "../layouts/ProjectLayout";
import Gallery from "../components/Gallery";
import ReportHero from "../components/ReportHero";
import Button, { ButtonGroup } from "../components/Button";

<ProjectLayout title="WYSIWYG Reports">

<ButtonGroup>
  <Button
    icon="sports_esports"
    href="https://wandb.ai/wandb/alors%20on%20danse/reports/A-New-Way-to-Create-Reports--VmlldzozOTg0OTg"
  >
    Demo
  </Button>
</ButtonGroup>

At Weights & Biases, I led the design and development of the Reports project, a mission to make it easy to share your machine learning research with your team and the world. As of July 2021, more than 500 reports are created every week.

<ReportHero />

## The Problem

When I joined W&B, reports already existed, but they were designed for only one purpose: sharing progress updates internally with teammates. As a result, little effort was put into presentation; reports were not visually clean or mobile friendly.

<Gallery
  sources={["https://storage.googleapis.com/john-portfolio/wysiwyg/old.png"]}
  frame="before"
/>

Secondly, the text editing experience was an afterthought, since generally only short snippets and captions were needed.

Lastly, reports weren't designed to be collaborative; only the author of a report could edit it.

We saw an opportunity to enable researchers to quickly publish their research to the world using the reports that they were already creating for internal use. But for this to work, we needed to make reports presentable, suitable for longform rich text, and collaborative.

## Process?

We iterated on reports for the entire 2+ years I was at W&B. Because reports already had many active users, we chose to solve one problem at a time and maintain backwards compatibility at each step.

Being a startup, our process was ad-hoc. I would always do the design and share it with the Shawn (CTO) and Carey (Head of Product) for feedback and approval. I designed some features via Figma mocks, others via written specifications. Sometimes I implemented the design myself, sometimes I coordinated with [Altay Guvench](https://www.linkedin.com/in/altay/) and/or [Axel Setyanto](https://www.linkedin.com/in/axelsetyanto/) on the implementation. We conducted user interviews as necessary.

## Inspiration

Notion and Dropbox Paper were our biggest inspirations in the Reports design. We loved the way they auto-convert Markdown formatting, so we borrowed that idea in Reports:

<Gallery
  sources={[
    "https://storage.googleapis.com/john-portfolio/wysiwyg/markdown-shortcuts.mov",
  ]}
  bordered
/>

We also borrowed from Notion the slash menu, used for adding anything that doesn't have a Markdown shortcut, or anything you don't remember the Markdown shortcut for:

<Gallery
  sources={[
    "https://storage.googleapis.com/john-portfolio/wysiwyg/slash-menu.mov",
  ]}
  bordered
/>

## Hardest decisions

### Realtime collaboration vs. async collaboration

Realtime collaboration is now the gold standard for document editors, set forth by tools like Google Docs and Notion. And it's really cool and fun to implement. But our reports architecture wasn't designed for realtime collaboration, so implementing it would have required tremendous refactors. As much as I wanted to do it, it was more prudent to first solve the lower hanging fruit of letting multiple users work on the same document at all.

This turned out to be more complex than I had anticipated. What do you do when a user tries to edit a report while another user is already editing it?

The simplest possible solution would be to lock everyone else out while a user is editing a report. This is the solution employed by Webflow. But because we used Webflow for our marketing site, we knew that this solution creates a terrible user experience. The problem is that it's too easy to accidentally block someone from editing the site, because you may forget that the tab is still open and Webflow has no way to tell whether you're really done editing.

After some deliberation, I decided to adopt a git-like system. When you edit a report, you create a draft copy of it private to yourself, like a local clone of a repository. Each user with edit access can have their own private draft of a report. As you edit a private draft, it's autosaved so that you can make long-running edits. When you're ready to publish your changes, you can merge into the "master" report, and you'll be informed of any potential merge conflicts.

<Gallery
  sources={["https://storage.googleapis.com/john-portfolio/wysiwyg/drafts.mov"]}
  bordered
/>

Later on I quietly implemented a proof-of-concept of realtime collaboration, just for fun. It drew delight from the team but probably won't see production for awhile.

<Gallery
  sources={[
    "https://storage.googleapis.com/john-portfolio/wysiwyg/collaboration.mov",
  ]}
  frame="prototype"
/>

### Default text width

Text is most readable at less than 70 characters per line. But visualizations want to be wider than that. Should we align the text to the visualizations, or should we make the text readable at the cost of awkward alignment when there's little text?

<Gallery
  sources={[
    "https://storage.googleapis.com/john-portfolio/wysiwyg/text-width.mov",
  ]}
  bordered
/>

We initially opted to default to wide text since longform text was uncommon. But as we grew Reports into more of a publishing platform, we switched the default text width to be readable.

### Markdown vs. WYSIWYG

Report text editing was initially all markdown based because it was easier to implement and the user base is very technical. Historically, technical users have expressed a [visceral hatred towards WYSIWYG editors](https://news.ycombinator.com/item?id=21589647).

However, Markdown doesn't support complex interactive visualizations. We initially tried to work around this by allowing users to add separate Markdown sections and visualization sections, never the twain shall meet. Unfortunately this had crippling side effects:

- Switching between preview and display mode of a Markdown section would cause the entire rest of the document to bounce up and down, especially when images were present.
- You couldn't easily move the cursor across a visualization section, cmd+A would only highlight the active Markdown section, etc.; a report didn't feel like a single cohesive document.
- Dropbox Paper-style collapsing headings were virtually impossible to implement in a sane way.

Ultimately we decided that WYSIWYG was the only way to get the user experience we really wanted. But for users who preferred Markdown, we supported inserting Markdown blocks that behaved like the old Markdown sections and looked indistinguishable from content made with WYSIWYG. We then created an optional path for users to convert their old Markdown sections into WYSIWYG, either one block at a time or all at once.

</ProjectLayout>
